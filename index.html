<!DOCTYPE html>
<html ng-app="test">
<head>
	<title>NearChat</title>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
	<script type="text/javascript">
		angular.module('test', []).config(($locationProvider) => {
			$locationProvider.html5Mode(true);
		}).controller('body',($scope,$location,$http) => {
			var code	= $location.search().code;
			if(!code)
				return;
			
			$http.get("https://librarinth.azurewebsites.net/api/LineLogin?code=DQtBoRHnMrFc3glzZfOJf8fFAp7xGmzFknG/TTfu0pwq7SWcR3UALQ==&linecode=" + code).then((response) => {
				console.log(response);
				$scope.data = response.data;
				return $scope.data;
			}.then((data) => {
				return $http.get({
					url: "https://api.line.me/v1/profile",
					headers : { Authorization: 'Bearer ' + data.access_token }
				});
			}).then((response) => {
				console.log(response);
				$scope.data = response.data;
			});
		});
	</script>
	<base href="/" />
</head>
<body ng-controller="body" style="margin:0;padding:0;height:100vh">
	<a href="https://access.line.me/dialog/oauth/weblogin?response_type=code&client_id=1487399503&redirect_uri=https://nyarchat.github.io&state=Test">
		Line Login
	</a>
	
	<div>
		{{data}}
	</div>
	<div>
		{{error}}
	</div>
</body>

</html>
